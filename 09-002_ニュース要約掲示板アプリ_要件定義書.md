### 文書番号: 09-002

## 1. アプリ名
- アプリ名: ニュース要約掲示板アプリ

## 2. 概要
複数のニュースサイトからRSS（Really Simple Syndication）フィードを取得し、OpenAI APIで要約を生成し、SSD1306 OLEDモジュールに日本語で横スクロール表示するPythonアプリケーションです。RSSフィードは多くのニュースサイトが提供している標準的な配信形式で、APIキーの取得や利用制限を気にすることなく、自由に最新ニュースを取得できます。OLED（128×64ピクセル）により、日本語の見やすい表示が可能になりました。生成されたニュースは次の更新時間（3時間後）まで連続ループで表示され、常に最新情報を確認できます。Web表示は行わず、ハードウェア上の小型ディスプレイのみで情報を確認します。

## 3. 目的
- OpenAI APIを用いたテキスト要約技術の習得
- RSSフィードからのニュースデータ取得方法を学ぶ
- 複数のニュースソースを統合した情報収集システムの構築
- SSD1306 OLEDへの日本語テキストスクロール表示手法を理解する
- Pillow（PIL）ライブラリによる画像処理・フォント描画技術の習得

## 4. 対象利用者
- プログラミング初心者（機器制御とAPI利用の入門）
- Raspberry Pi入門者
- AI要約機能を学びたい学生・教育者
- RSS技術を学びたい学習者

## 5. システム構成
| コンポーネント                      | 型番・仕様                                              | 役割                                                    |
|-------------------------------------|--------------------------------------------------------|---------------------------------------------------------|
| Raspberry Pi 5                      | Raspberry Pi 5                                         | I²C通信制御、スクリプト実行、API呼び出し              |
| ブレッドボード                      | 汎用ブレッドボード                                      | 各モジュールの固定および配線                            |
| ジャンパーワイヤ                    | オス–オス                                              | Raspberry Piと各モジュールの接続                       |
| SSD1306 OLEDディスプレイモジュール  | I²C接続、128×64ピクセル（3.3Vまたは5V動作）           | 日本語テキスト表示、グラフィック描画                    |
| 双方向ロジックレベル変換モジュール   | BSS138搭載 4チャンネル（3.3V⇔5V）※5V OLED使用時のみ  | Raspberry Pi（3.3V）とOLED（5V）間の電圧レベル変換    |
| ネットワーク                        | Wi-FiまたはEthernet                                    | RSSフィード取得・OpenAI API通信                        |
| RSSフィードソース                   | MIT Technology Review AI、TechCrunch AI、ITmedia AI+  | 最新AI関連ニュース記事の配信                           |
| OpenAI API                          | 外部サービス（gpt-5-mini）                             | 取得したニュース記事を要約                              |

## 6. ハードウェア要件

### 6.1 必須コンポーネント
- **Raspberry Pi 5本体**
- **microSDカード**（Raspberry Pi OSインストール済み）
- **SSD1306 OLEDディスプレイモジュール**
  - I²C接続、128×64ピクセル
  - 動作電圧: 3.3V～5V（本プロジェクトでは3.3V使用）
  - I²Cアドレス: 0x3C（デフォルト）
  - SSD1306コントローラ搭載
- **ジャンパーワイヤ**（オス–オス、4本）
- **ブレッドボード**（汎用サイズ）
- **電源**（公式5V/3A電源アダプタ推奨）
- **日本語フォントファイル**（NotoSansCJKjp-Regular.otf）

### 6.2 各デバイスの技術仕様

#### 6.2.1 SSD1306 OLED ディスプレイ
- **解像度**: 128×64ピクセル
- **通信プロトコル**: I²C
- **動作電圧**: 3.3V～5V
- **I²Cアドレス**: 0x3C（デフォルト）
- **表示色**: モノクロ（白/青）
- **視野角**: 160度以上
- **コントラスト**: プログラム制御可能（0～255）
- **特徴**:
  - 自己発光型ディスプレイ（バックライト不要）
  - 高コントラスト比
  - 広視野角
  - 低消費電力

#### 6.2.2 配線構成
**Raspberry Pi 5 ⇔ SSD1306 OLED（直接接続）**

| Raspberry Pi 5 | SSD1306 OLED |
|----------------|--------------|
| 3.3V (Pin 1)   | VCC          |
| GND (Pin 6)    | GND          |
| SDA (Pin 3)    | SDA          |
| SCL (Pin 5)    | SCL          |

**注意**: OLEDモジュールは3.3V動作のため、レベル変換モジュールは不要です。Raspberry Piと直接接続できます。

## 7. ソフトウェア要件
- **OS**: Raspberry Pi OS（最新推奨）
- **言語**: Python 3.9以上
- **必須ライブラリ**:
  - **feedparser**: RSSフィード解析
  - **openai**: OpenAI APIクライアント（gpt-5-mini使用）
  - **luma.oled**: SSD1306 OLED制御ライブラリ
  - **pillow (PIL)**: 画像処理、フォント描画
  - **python-dotenv**: 環境変数管理
- **I²C有効化**: `sudo raspi-config`でI²Cインターフェースを有効化
- **I²C確認ツール**: `i2c-tools`パッケージ（`i2cdetect`コマンド使用）
- **日本語フォント**: NotoSansCJKjp-Regular.otf（`assets/fonts/`ディレクトリに配置）
- **参考実装**:
  - GPT API呼び出し: [09-001-gpt-response-minimal](https://github.com/Murasan201/09-001-gpt-response-minimal) (gpt-5使用のテンプレート)
  - [OpenAI API サンプル](https://murasan-net.com/2025/03/20/openai-api-sample-2025/)

## 8. 機能要件
1. **APIキー読み込み**
   - `.env` または環境変数から `OPENAI_API_KEY` を取得
   - 環境変数 `UPDATE_INTERVAL`（更新間隔、分単位、デフォルト180分）を取得
   - 環境変数 `MAX_ARTICLES`（各サイトから取得する記事数、デフォルト3件）を取得
2. **OLED初期化**
   - luma.oledライブラリを使用してSSD1306 OLEDモジュールを初期化
   - I²Cアドレス指定（デフォルト: 0x3C）
   - I²Cポート指定（デフォルト: 1）
   - 解像度: 128×64ピクセル
   - コントラスト: 255（最大）
   - 起動メッセージを表示（"News Display" / "Starting..."）
   - エラー発生時はシミュレーションモードで動作
   - 日本語フォント（NotoSansCJKjp-Regular.otf）を読み込み
3. **RSSフィード取得（feedparserライブラリ使用）**
   - 複数のRSSフィードソースから最新記事を取得:
     - MIT Technology Review AI
     - TechCrunch AI
     - ITmedia AI+
   - 各フィードから最大 `MAX_ARTICLES` 件（デフォルト3件）の記事を取得
   - 各記事のタイトル（title）、要約（summary）、リンク（link）を抽出
   - フォーマット: `"- {title}: {summary}"`
   - 取得失敗時は空リストを返し、エラーログを記録
4. **AI要約生成（OpenAI API gpt-5-mini使用）**
   - サイト名と記事リストを受け取り、統合要約を生成
   - プロンプト設計:
     - 「技術トレンドや注目ポイントがひと目でわかる」ように指示
     - 日本語で250文字以内の箇条書き要約
     - 複数記事を統合して要約
   - モデル: gpt-5-mini（推論モデル）
   - max_completion_tokens: 4000（推論トークン用に十分な容量を確保）
   - システムメッセージ: "あなたは有能な技術ニュース要約アシスタントです。"
   - トークン使用量のログ記録（入力、出力、推論トークン）
   - 要約生成失敗時はエラーメッセージを返す
   - **ローディングアニメーション**: API呼び出し中は「生成中...」メッセージをアニメーション表示
5. **OLED表示**
   - **初期化処理**:
     - ssd1306(serial, width=128, height=64)
     - OLED接続エラー時はシミュレーションモードに切り替え
   - **固定表示**（画面幅以内）:
     - 画面に表示して3秒間待機
   - **スクロール表示**（画面幅超）:
     - ピクセル単位で左にスクロール
     - スクロール速度: 8ピクセル/フレーム
     - フレーム遅延: 0.02秒
     - スクロール完了後に画面をクリアして完全にフェードアウト
   - **表示フロー**:
     - 現在時刻付きヘッダー表示
     - 各サイト名を表示
     - 各サイトの要約を行ごとに表示
     - 各ブロック間に適切な待機時間
6. **ニュースループ表示機能**
   - 全サイトからニュースを取得・要約後、`all_summaries`リストに保存
   - 次の更新時間（`UPDATE_INTERVAL`後）まで、保存したニュースを連続ループ表示
   - ループごとに現在時刻のヘッダーを更新
   - 更新時間に達したら新しいニュースを取得
7. **定期更新機能**
   - 無限ループで以下を繰り返し:
     - RSSフィード取得 → AI要約生成 → 要約保存
     - 次の更新時間までニュースをループ表示
     - `UPDATE_INTERVAL` 分（デフォルト180分=3時間）後に新しいニュースを取得
   - Ctrl+C（KeyboardInterrupt）で終了
   - 終了時に "Goodbye!" メッセージを表示し、画面をクリア

## 9. 非機能要件
- **可読性**:
  - コードはPEP8準拠
  - 日本語コメントで初心者にもわかりやすい説明
  - 関数ごとにdocstring記述
- **保守性**:
  - 関数ベースの設計でOLED操作を分離
  - 関数分割とモジュール化により拡張しやすい設計
- **単一ファイル完結**: 一つのPythonファイルで実装
- **移植性**:
  - luma.oledライブラリを使用し、他のOLEDディスプレイにも対応可能
  - 設定値（I²Cアドレス、ポート、フォントパス）をコード冒頭の定数で変更可能
- **信頼性**: ネットワーク障害やAPIエラー時にエラーログを実装
- **安全性**:
  - 3.3V動作OLEDを使用し、配線を簡素化
  - 適切なエラーハンドリング実装
  - I²Cアドレス・ポートの検証

## 10. 安全要件
### 10.1 電圧レベル保護
- **OLEDモジュール（3.3V動作）**: レベル変換モジュールは不要
  - SSD1306 OLEDは3.3V動作のため、Raspberry Piと直接接続可能
  - 配線が簡素化され、信頼性が向上

### 10.2 配線時の注意事項
- 電源投入前に配線を確認
- VCCとGNDのショート防止
- ジャンパーワイヤの接続確認
- OLEDモジュールの動作電圧を確認（3.3Vまたは5V）

## 11. テスト要件
- **I²C有効化確認**: Raspberry Pi設定でI²Cが有効化されていることを確認
- **I²C通信テスト**: `sudo i2cdetect -y 1`でSSD1306のI²Cアドレス（0x3C）検出
- **ライブラリインストール確認**:
  - `pip list | grep -E "(feedparser|openai|luma|pillow|python-dotenv)"` で必要なライブラリが表示されること
- **フォント確認**:
  - `assets/fonts/NotoSansCJKjp-Regular.otf`が存在すること
  - フォント読み込みエラー時はデフォルトフォントに切り替わること
- **RSSフィード取得テスト**:
  - 各RSSフィードURLから記事が正常に取得できること
  - feedparserでのXML解析が正常に動作すること
  - 記事のタイトル、要約、リンクが正しく抽出されること
  - ネットワークエラー時に適切なエラーハンドリングが動作すること
- **AI要約生成テスト**:
  - 無効APIキー時のエラーハンドリング検証
  - 複数記事を統合した要約が250文字以内で生成されること
  - 日本語要約が正しく生成されること
  - 英語ソース記事が日本語で要約されること
  - トークン使用量（入力、出力、推論トークン）がログに記録されること
  - ローディングアニメーション（「生成中...」）が表示されること
- **OLED表示テスト**:
  - 短文（画面幅以内）で固定表示確認（3秒表示）
  - 長文（画面幅超）でスクロール動作確認（8px/フレーム、0.02秒遅延）
  - スクロール完了後に画面が完全にクリアされること
  - 各ニュース要約の切り替え動作確認
  - シミュレーションモードでの動作確認
- **ニュースループ表示テスト**:
  - 取得したニュースが`all_summaries`リストに保存されること
  - 次の更新時間までニュースがループ表示されること
  - ループごとに現在時刻が更新されること
- **定期更新テスト**:
  - UPDATE_INTERVAL設定値に応じた更新間隔で動作すること
  - 3時間（180分）サイクルで正常に動作すること
- **異常系テスト**:
  - 無効なI²Cアドレス指定時のシミュレーションモード切り替え確認
  - RSSフィード取得失敗時の適切なエラーメッセージ表示確認
  - OpenAI API呼び出し失敗時のエラーメッセージ表示確認
  - max_completion_tokens不足時の動作確認
- **割り込みテスト**: Ctrl+C押下時の適切な終了処理（"Goodbye!"メッセージ、OLED画面クリア）確認

## 12. 受け入れ基準
1. **ハードウェア構成**:
   - Raspberry PiとSSD1306 OLEDが直接接続されている（3.3V動作）
   - `sudo i2cdetect -y 1`でSSD1306のI²Cアドレス（0x3C）が検出される
2. **RSSフィード取得機能**:
   - 3つのRSSフィードソース（MIT Technology Review AI、TechCrunch AI、ITmedia AI+）から記事が正常に取得される
   - 各サイトから最大3件の記事（タイトル、要約、リンク）が取得される
   - ネットワークエラー時に適切なエラーログが記録される
3. **AI要約生成機能**:
   - OpenAI API（gpt-5-mini）で日本語要約が250文字以内で生成される
   - 複数記事が統合され、技術トレンドがひと目でわかる要約になっている
   - 英語ソースの記事も日本語で要約される
   - トークン使用量（入力、出力、推論トークン）がログに記録される
   - API呼び出し中にローディングアニメーション（「生成中...」）が表示される
4. **OLED表示機能**:
   - 起動時に "News Display" / "Starting..." が表示される
   - 現在時刻付きヘッダーが表示される
   - 各サイト名と要約が順次表示される
   - 画面幅以内のテキストは固定表示される（3秒）
   - 画面幅を超えるテキストはピクセル単位で横スクロール表示される（8px/フレーム、0.02秒遅延）
   - スクロール完了後に画面が完全にクリアされる
   - 日本語フォント（NotoSansCJKjp）で表示される
5. **ニュースループ表示機能**:
   - 取得したニュースが`all_summaries`リストに保存される
   - 次の更新時間（3時間後）までニュースが連続ループ表示される
   - ループごとに現在時刻のヘッダーが更新される
   - ループ回数がログに記録される
6. **シミュレーションモード**:
   - OLED未接続時やエラー時にシミュレーションモードに切り替わる
   - コンソールに "[OLED表示]" プレフィックス付きで出力される
   - プログラムが停止せずに動作し続ける
7. **定期更新機能**:
   - UPDATE_INTERVAL設定値（デフォルト180分=3時間）で自動更新される
   - ログに「ニュースのループ表示を開始します（○時間後に次の更新）」と表示される
   - 無限ループで動作し続ける
8. **エラーハンドリング**:
   - RSSフィード取得失敗時にエラーログが記録され、次のサイトに進む
   - OpenAI API呼び出し失敗時にエラーメッセージが生成される
   - I²C通信エラー時にシミュレーションモードに切り替わる
   - 予期しないエラーがログに記録される
9. **終了処理**:
   - Ctrl+C（KeyboardInterrupt）で正常に終了する
   - 終了時にOLEDに "Goodbye!" が表示される
   - 終了時にOLED画面がクリアされる
   - ログに「アプリケーションを終了します」と記録される
10. **安全性**:
   - 3.3V動作OLEDによりRaspberry Pi GPIOピンが保護されている
   - 環境変数にAPIキーが安全に格納される
   - .envファイルが.gitignoreで除外され、GitHubにアップロードされない

---
以上の要件をもとに、ニュース要約掲示板アプリのプロトタイプを開発してください。

## 13. 参考文献・データシート
- [SSD1306 OLED Display Datasheet](https://cdn-shop.adafruit.com/datasheets/SSD1306.pdf)
- [luma.oled Documentation](https://luma-oled.readthedocs.io/)
- [Pillow (PIL) Documentation](https://pillow.readthedocs.io/)
- [feedparser Documentation](https://feedparser.readthedocs.io/)
- [GPT API呼び出しテンプレート (gpt-5使用)](https://github.com/Murasan201/09-001-gpt-response-minimal)
- [OpenAI API サンプル](https://murasan-net.com/2025/03/20/openai-api-sample-2025/)

---

**最終更新**: 2025年10月28日
**文書番号**: 09-002
**バージョン**: 3.0
