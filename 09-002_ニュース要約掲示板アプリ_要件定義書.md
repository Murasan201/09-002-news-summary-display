### 文書番号: 09-002

## 1. アプリ名
- アプリ名: ニュース要約掲示板アプリ

## 2. 概要
複数のニュースサイトからRSS（Really Simple Syndication）フィードを取得し、OpenAI APIで要約を生成し、SSD1306 OLEDモジュールに日本語で横スクロール表示するPythonアプリケーションです。RSSフィードは多くのニュースサイトが提供している標準的な配信形式で、APIキーの取得や利用制限を気にすることなく、自由に最新ニュースを取得できます。OLED（128×64ピクセル）により、日本語の見やすい表示が可能になりました。Web表示は行わず、ハードウェア上の小型ディスプレイのみで情報を確認します。

## 3. 目的
- OpenAI APIを用いたテキスト要約技術の習得
- RSSフィードからのニュースデータ取得方法を学ぶ
- 複数のニュースソースを統合した情報収集システムの構築
- SSD1306 OLEDへの日本語テキストスクロール表示手法を理解する
- Pillow（PIL）ライブラリによる画像処理・フォント描画技術の習得

## 4. 対象利用者
- プログラミング初心者（機器制御とAPI利用の入門）
- Raspberry Pi入門者
- AI要約機能を学びたい学生・教育者
- RSS技術を学びたい学習者

## 5. システム構成
| コンポーネント                      | 型番・仕様                                              | 役割                                                    |
|-------------------------------------|--------------------------------------------------------|---------------------------------------------------------|
| Raspberry Pi 5                      | Raspberry Pi 5                                         | I²C通信制御、スクリプト実行、API呼び出し              |
| ブレッドボード                      | 汎用ブレッドボード                                      | 各モジュールの固定および配線                            |
| ジャンパーワイヤ                    | オス–オス                                              | Raspberry Piと各モジュールの接続                       |
| SSD1306 OLEDディスプレイモジュール  | I²C接続、128×64ピクセル（3.3V動作）                   | 日本語テキスト表示、グラフィック描画                    |
| ネットワーク                        | Wi-FiまたはEthernet                                    | RSSフィード取得・OpenAI API通信                        |
| RSSフィードソース                   | MIT Technology Review AI、AI News、ITmedia AI+        | 最新AI関連ニュース記事の配信                           |
| OpenAI API                          | 外部サービス（gpt-5-mini）                             | 取得したニュース記事を要約                              |

## 6. ハードウェア要件

### 6.1 必須コンポーネント
- **Raspberry Pi 5本体**
- **microSDカード**（Raspberry Pi OSインストール済み）
- **SSD1306 OLEDディスプレイモジュール**
  - 128×64ピクセル グラフィックOLED
  - I²C接続（デフォルトアドレス: 0x3C）
  - 3.3V動作（Raspberry Pi GPIOと電圧互換、レベル変換不要）
  - 日本語フォント表示対応
- **ジャンパーワイヤ**（オス–オス、4本）
- **ブレッドボード**（汎用サイズ）
- **電源**（公式5V/3A電源アダプタ推奨）

### 6.2 各デバイスの技術仕様

#### 6.2.1 SSD1306 OLEDコントローラ
- **動作電圧範囲**: 3.3V
- **ディスプレイサイズ**: 128×64ピクセル
- **I²Cインターフェース**: 標準モード 100kHz、高速モード 400kHz対応
- **I²Cアドレス**: 0x3C（デフォルト）、0x3D（オプション）
- **グレースケール**: モノクロ（白/黒）
- **視野角**: >160°

#### 6.2.2 配線構成
**Raspberry Pi 5 ⇔ SSD1306 OLED (3.3V)**

| Raspberry Pi 5 | SSD1306 OLED |
|----------------|--------------|
| 3.3V (Pin 1)   | VCC          |
| GND (Pin 6)    | GND          |
| SDA (Pin 3)    | SDA          |
| SCL (Pin 5)    | SCL          |

レベル変換器は不要です。3.3V版OLEDを直接接続します。

## 7. ソフトウェア要件
- **OS**: Raspberry Pi OS（最新推奨）
- **言語**: Python 3.9以上
- **必須ライブラリ**:
  - **feedparser**: RSSフィード解析
  - **openai**: OpenAI APIクライアント（gpt-5-mini使用）
  - **luma.oled**: SSD1306 OLED制御
  - **Pillow (PIL)**: 画像処理・フォント描画
  - **python-dotenv**: 環境変数管理
- **I²C有効化**: `sudo raspi-config`でI²Cインターフェースを有効化
- **I²C確認ツール**: `i2c-tools`パッケージ（`i2cdetect`コマンド使用）
- **参考実装**:
  - [OpenAI API サンプル](https://murasan-net.com/2025/03/20/openai-api-sample-2025/)
  - OLED表示処理: 06-004-ssd1306-oled-jp-displayプロジェクトの実装に準拠

## 8. 機能要件
1. **APIキー読み込み**
   - `.env` または環境変数から `OPENAI_API_KEY` を取得
   - 環境変数 `UPDATE_INTERVAL`（更新間隔、分単位）を取得
   - 環境変数 `MAX_ARTICLES`（各サイトから取得する記事数）を取得
2. **I²C通信初期化（06-004-ssd1306-oled-jp-displayプロジェクトの実装方式に準拠）**
   - luma.oledライブラリを使用してSSD1306 OLEDモジュールを初期化
   - I²Cアドレス指定（デフォルト: 0x3C）
   - I²Cポート指定（デフォルト: 1）
   - 128×64ピクセルの設定
   - 日本語フォント（Noto Sans CJK JP）の読み込み
   - エラー発生時はシミュレーションモードで動作
3. **RSSフィード取得（feedparserライブラリ使用）**
   - 複数のRSSフィードソースから最新記事を取得:
     - MIT Technology Review AI
     - AI News
     - ITmedia AI+
   - 各フィードから最大 `MAX_ARTICLES` 件（デフォルト3件）の記事を取得
   - 各記事のタイトル（title）、要約（summary）、リンク（link）を抽出
   - フォーマット: `"- {title}: {summary}"`
   - 取得失敗時は空リストを返し、エラーログを記録
4. **AI要約生成（OpenAI API gpt-5-mini使用）**
   - サイト名と記事リストを受け取り、統合要約を生成
   - プロンプト設計:
     - 「技術トレンドや注目ポイントがひと目でわかる」ように指示
     - 日本語で250文字以内の箇条書き要約
     - 複数記事を統合して要約
   - モデル: gpt-5-mini
   - temperature: 0.3（一貫性のある出力）
   - システムメッセージ: "あなたは有能な技術ニュース要約アシスタントです。"
   - 要約生成失敗時はエラーメッセージを返す
5. **OLED表示（06-004-ssd1306-oled-jp-displayプロジェクトの実装方式に準拠）**
   - **初期化処理**:
     - luma.oled.device.ssd1306(serial.i2c(port=1, address=0x3C))
     - 日本語フォント（Noto Sans CJK JP）の読み込み
     - OLED接続エラー時はシミュレーションモードに切り替え
   - **横スクロール表示**:
     - Pillowで画像バッファを作成（128×64ピクセル）
     - ImageDrawで日本語テキストを描画
     - 1ピクセルずつ左にスクロール
     - scroll_delay間隔で更新（デフォルト0.03秒）
     - スクロール完了後1秒待機
   - **表示フロー**:
     - 現在時刻付きヘッダー表示
     - 各サイト名を表示
     - 各サイトの要約を横スクロール表示
     - 各ブロック間に2秒の待機時間
6. **定期更新機能**
   - 無限ループで以下を繰り返し:
     - RSSフィード取得 → AI要約生成 → OLED表示
     - `UPDATE_INTERVAL` 分（デフォルト180分=3時間）待機
     - 次のサイクル開始
   - Ctrl+C（KeyboardInterrupt）で終了
   - 終了時に "Goodbye!" メッセージを表示

## 9. 非機能要件
- **可読性**:
  - コードはPEP8準拠
  - 日本語コメントで初心者にもわかりやすい説明
  - 関数・クラスごとにdocstring記述
- **保守性**:
  - クラスベースの設計でOLED操作をカプセル化
  - 関数分割とモジュール化により拡張しやすい設計
- **単一ファイル完結**: 可能な限り一つのPythonファイルで実装
- **移植性**:
  - luma.oledライブラリを使用し、他のOLEDコントローラにも対応可能
  - 設定値（I²Cアドレス、ポート）をコマンドライン引数で変更可能
- **信頼性**: ネットワーク障害やAPIエラー時にリトライとエラーログを実装
- **安全性**:
  - 3.3V版OLEDの使用により、Raspberry Pi GPIOと電圧互換性を確保
  - 適切なエラーハンドリング実装
  - I²Cアドレス・引数の検証

## 10. 安全要件
### 10.1 電圧仕様
- **OLEDモジュール**: 3.3V動作のSSD1306を使用
  - Raspberry Pi GPIO（3.3V）と電圧互換
  - レベル変換器は不要
  - I²C信号（SDA/SCL）は3.3Vで直接接続
- **注意**: このプロジェクトでは3.3V版OLEDのみをサポート

### 10.2 配線時の注意事項
- 電源投入前に配線を確認
- VCCとGNDのショート防止
- ジャンパーワイヤの接続確認

## 11. テスト要件
- **I²C有効化確認**: Raspberry Pi設定でI²Cが有効化されていることを確認
- **I²C通信テスト**: `i2cdetect -y 1`でSSD1306のI²Cアドレス（0x3C）検出
- **OLED表示確認**: 初期化メッセージが正常に表示されることを確認
- **ライブラリインストール確認**:
  - `pip list | grep -E "(feedparser|openai|luma|pillow|python-dotenv)"` で5つのライブラリが表示されること
- **RSSフィード取得テスト**:
  - 各RSSフィードURLから記事が正常に取得できること
  - feedparserでのXML解析が正常に動作すること
  - 記事のタイトル、要約、リンクが正しく抽出されること
  - ネットワークエラー時に適切なエラーハンドリングが動作すること
- **AI要約生成テスト**:
  - 無効APIキー時のエラーハンドリング検証
  - 複数記事を統合した要約が250文字以内で生成されること
  - 日本語要約が正しく生成されること
  - 英語ソース記事が日本語で要約されること
- **OLED表示テスト**:
  - 日本語フォント（Noto Sans CJK JP）の読み込み確認
  - テキストの横スクロール動作確認（0.03秒間隔）
  - 各ニュース要約の切り替え動作確認（2秒間隔）
  - シミュレーションモードでの動作確認
- **定期更新テスト**:
  - UPDATE_INTERVAL設定値に応じた更新間隔で動作すること
  - 3時間（180分）サイクルで正常に動作すること
- **異常系テスト**:
  - 無効なI²Cアドレス指定時のシミュレーションモード切り替え確認
  - RSSフィード取得失敗時の適切なエラーメッセージ表示確認
  - OpenAI API呼び出し失敗時のエラーメッセージ表示確認
- **割り込みテスト**: Ctrl+C押下時の適切な終了処理（"Goodbye!"メッセージ、OLED画面クリア）確認

## 12. 受け入れ基準
1. **ハードウェア構成**:
   - Raspberry PiとSSD1306 OLED（3.3V版）が正しく直接接続されている
   - `i2cdetect -y 1`でSSD1306のI²Cアドレス（0x3C）が検出される
2. **RSSフィード取得機能**:
   - 3つのRSSフィードソース（MIT Technology Review AI、AI News、ITmedia AI+）から記事が正常に取得される
   - 各サイトから最大3件の記事（タイトル、要約、リンク）が取得される
   - ネットワークエラー時に適切なエラーログが記録される
3. **AI要約生成機能**:
   - OpenAI API（gpt-5-mini）で日本語要約が250文字以内で生成される
   - 複数記事が統合され、技術トレンドがひと目でわかる要約になっている
   - 英語ソースの記事も日本語で要約される
4. **OLED表示機能**:
   - OLED初期化成功（128×64ピクセル）
   - 日本語フォント（Noto Sans CJK JP）読み込み成功
   - 現在時刻付きヘッダーが表示される
   - 各サイト名と要約が順次表示される
   - テキストが滑らかに横スクロール表示される（0.03秒間隔）
   - 各ブロック間に2秒の待機時間がある
5. **シミュレーションモード**:
   - OLED未接続時やエラー時にシミュレーションモードに切り替わる
   - コンソールに "[OLED表示]" プレフィックス付きで出力される
   - プログラムが停止せずに動作し続ける
6. **定期更新機能**:
   - UPDATE_INTERVAL設定値（デフォルト180分=3時間）で自動更新される
   - ログに「○時間後に次の更新を行います...」と表示される
   - 無限ループで動作し続ける
7. **エラーハンドリング**:
   - RSSフィード取得失敗時にエラーログが記録され、次のサイトに進む
   - OpenAI API呼び出し失敗時にエラーメッセージが生成される
   - I²C通信エラー時にシミュレーションモードに切り替わる
   - 予期しないエラーがログに記録される
8. **終了処理**:
   - Ctrl+C（KeyboardInterrupt）で正常に終了する
   - 終了時にOLEDに "Goodbye!" が表示される
   - 終了時にOLED画面がクリアされる
   - ログに「アプリケーションを終了します」と記録される
9. **安全性**:
   - 3.3V版OLEDの使用により、Raspberry Pi GPIOと電圧互換性が確保されている
   - 環境変数にAPIキーが安全に格納される
   - .envファイルが.gitignoreで除外され、GitHubにアップロードされない

---
以上の要件をもとに、ニュース要約掲示板アプリのプロトタイプを開発してください。

## 13. 参考文献・データシート
- [SSD1306 OLED Driver Datasheet](https://cdn-shop.adafruit.com/datasheets/SSD1306.pdf)
- [luma.oled Documentation](https://luma-oled.readthedocs.io/)
- [Pillow Documentation](https://pillow.readthedocs.io/)
- [OpenAI API サンプル](https://murasan-net.com/2025/03/20/openai-api-sample-2025/)

---

**最終更新**: 2025年10月27日
**文書番号**: 09-002
**バージョン**: 2.0
