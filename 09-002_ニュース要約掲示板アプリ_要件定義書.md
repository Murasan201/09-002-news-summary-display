### 文書番号: 09-002

## 1. アプリ名
- アプリ名: ニュース要約掲示板アプリ

## 2. 概要
複数のニュースサイトからRSS（Really Simple Syndication）フィードを取得し、OpenAI APIで要約を生成し、SSD1306 OLEDモジュールに日本語で横スクロール表示するPythonアプリケーションです。RSSフィードは多くのニュースサイトが提供している標準的な配信形式で、APIキーの取得や利用制限を気にすることなく、自由に最新ニュースを取得できます。OLED（128×64ピクセル）により、日本語の見やすい表示が可能になりました。Web表示は行わず、ハードウェア上の小型ディスプレイのみで情報を確認します。

## 3. 目的
- OpenAI APIを用いたテキスト要約技術の習得
- RSSフィードからのニュースデータ取得方法を学ぶ
- 複数のニュースソースを統合した情報収集システムの構築
- SSD1306 OLEDへの日本語テキストスクロール表示手法を理解する
- Pillow（PIL）ライブラリによる画像処理・フォント描画技術の習得

## 4. 対象利用者
- プログラミング初心者（機器制御とAPI利用の入門）
- Raspberry Pi入門者
- AI要約機能を学びたい学生・教育者
- RSS技術を学びたい学習者

## 5. システム構成
| コンポーネント                      | 型番・仕様                                              | 役割                                                    |
|-------------------------------------|--------------------------------------------------------|---------------------------------------------------------|
| Raspberry Pi 5                      | Raspberry Pi 5                                         | I²C通信制御、スクリプト実行、API呼び出し              |
| ブレッドボード                      | 汎用ブレッドボード                                      | 各モジュールの固定および配線                            |
| ジャンパーワイヤ                    | オス–オス                                              | Raspberry Piと各モジュールの接続                       |
| SSD1306 OLEDディスプレイモジュール  | I²C接続、128×64ピクセル（3.3Vまたは5V動作）           | 日本語テキスト表示、グラフィック描画                    |
| 双方向ロジックレベル変換モジュール   | BSS138搭載 4チャンネル（3.3V⇔5V）※5V OLED使用時のみ  | Raspberry Pi（3.3V）とOLED（5V）間の電圧レベル変換    |
| ネットワーク                        | Wi-FiまたはEthernet                                    | RSSフィード取得・OpenAI API通信                        |
| RSSフィードソース                   | MIT Technology Review AI、AI News、ITmedia AI+        | 最新AI関連ニュース記事の配信                           |
| OpenAI API                          | 外部サービス（gpt-5-mini）                             | 取得したニュース記事を要約                              |

## 6. ハードウェア要件

### 6.1 必須コンポーネント
- **Raspberry Pi 5本体**
- **microSDカード**（Raspberry Pi OSインストール済み）
- **LCD1602ディスプレイモジュール**
  - HD44780互換LCDコントローラ
  - PCF8574T I²Cバックパック搭載
  - デフォルトI²Cアドレス: 0x27（PCF8574T）または0x3F（PCF8574AT）
  - 内蔵コントラスト調整用可変抵抗器
- **双方向ロジックレベル変換モジュール**
  - BSS138 MOSFET搭載 4チャンネル
  - 対応電圧: 低電圧側 1.8V～ / 高電圧側 ～10V（本プロジェクトでは3.3V⇔5V変換）
  - I²C通信対応（最大2MHz）
  - 製品例: VKLSVAN 4チャンネル双方向ロジックレベル変換モジュール
- **ジャンパーワイヤ**（オス–オス、10本程度）
- **ブレッドボード**（汎用サイズ）
- **電源**（公式5V/3A電源アダプタ推奨）

### 6.2 各デバイスの技術仕様

#### 6.2.1 PCF8574T I²C I/Oエクスパンダ
- **動作電圧範囲**: 2.5V～6V
- **I²Cインターフェース**: 標準モード 100kHz
- **I/Oポート数**: 8ビット双方向
- **ESD保護**: HBM 2,000V以上、CDM 1,000V以上
- **LCD接続ピン配置**:
  - P0: RS（レジスタ選択）
  - P1: RW（読み書き制御）
  - P2: E（イネーブル）
  - P3: バックライト制御
  - P4-P7: D4-D7（データ線）

#### 6.2.2 BSS138 双方向ロジックレベル変換モジュール
- **使用FET**: BSS138 x 4個
- **プルアップ抵抗**: 10kΩ（各チャンネル）
- **チャンネル数**: 4チャンネル独立双方向変換
- **低電圧側対応**: 1.8V～
- **高電圧側対応**: ～10V
- **オン抵抗**: 3.5Ω（BSS138）
- **入力容量**: 40pF
- **連続電流**: 200mA
- **ピーク電流**: 1A（最大しきい値電圧時）
- **対応プロトコル**: I²C、TTL Serial、低速SPI（<2MHz）、その他デジタルインターフェース

#### 6.2.3 配線構成
**Raspberry Pi 5 (3.3V側) ⇔ レベル変換モジュール ⇔ LCD1602 + PCF8574T (5V側)**

| Raspberry Pi 5 | レベル変換（LV側）| レベル変換（HV側）| PCF8574T/LCD |
|----------------|------------------|------------------|--------------|
| 3.3V (Pin 1)   | LV               | -                | -            |
| 5V (Pin 2)     | -                | HV               | VCC          |
| GND (Pin 6)    | GND              | GND              | GND          |
| SDA (Pin 3)    | LV1              | HV1              | SDA          |
| SCL (Pin 5)    | LV2              | HV2              | SCL          |

## 7. ソフトウェア要件
- **OS**: Raspberry Pi OS（最新推奨）
- **言語**: Python 3.9以上
- **必須ライブラリ**:
  - **feedparser**: RSSフィード解析
  - **openai**: OpenAI APIクライアント（gpt-5-mini使用）
  - **RPLCD** (>=1.3.0): LCD1602制御、PCF8574対応
  - **smbus2** (>=0.4.0): I²C通信
  - **python-dotenv**: 環境変数管理
- **I²C有効化**: `sudo raspi-config`でI²Cインターフェースを有効化
- **I²C確認ツール**: `i2c-tools`パッケージ（`i2cdetect`コマンド使用）
- **参考実装**:
  - [OpenAI API サンプル](https://murasan-net.com/2025/03/20/openai-api-sample-2025/)
  - LCD表示処理: 06-002-lcd1602-displayプロジェクトの実装に準拠

## 8. 機能要件
1. **APIキー読み込み**
   - `.env` または環境変数から `OPENAI_API_KEY` を取得
   - 環境変数 `UPDATE_INTERVAL`（更新間隔、分単位）を取得
   - 環境変数 `MAX_ARTICLES`（各サイトから取得する記事数）を取得
2. **I²C通信初期化（06-002-lcd1602-displayプロジェクトの実装方式に準拠）**
   - RPLCDライブラリを使用してPCF8574T経由でLCD1602モジュールを初期化
   - I²Cアドレス指定（デフォルト: 0x27）
   - I²Cポート指定（デフォルト: 1）
   - 16文字×2行の設定
   - 起動メッセージを表示（"News Display" / "Starting..."）
   - エラー発生時はシミュレーションモードで動作
3. **RSSフィード取得（feedparserライブラリ使用）**
   - 複数のRSSフィードソースから最新記事を取得:
     - MIT Technology Review AI
     - AI News
     - ITmedia AI+
   - 各フィードから最大 `MAX_ARTICLES` 件（デフォルト3件）の記事を取得
   - 各記事のタイトル（title）、要約（summary）、リンク（link）を抽出
   - フォーマット: `"- {title}: {summary}"`
   - 取得失敗時は空リストを返し、エラーログを記録
4. **AI要約生成（OpenAI API gpt-5-mini使用）**
   - サイト名と記事リストを受け取り、統合要約を生成
   - プロンプト設計:
     - 「技術トレンドや注目ポイントがひと目でわかる」ように指示
     - 日本語で250文字以内の箇条書き要約
     - 複数記事を統合して要約
   - モデル: gpt-5-mini
   - temperature: 0.3（一貫性のある出力）
   - システムメッセージ: "あなたは有能な技術ニュース要約アシスタントです。"
   - 要約生成失敗時はエラーメッセージを返す
5. **LCD表示（06-002-lcd1602-displayプロジェクトの実装方式に準拠）**
   - **初期化処理**:
     - CharLCD(i2c_expander='PCF8574', address=0x27, port=1, cols=16, rows=2)
     - LCD接続エラー時はシミュレーションモードに切り替え
   - **通常表示**（16文字以内）:
     - lcd.clear()で画面クリア
     - lcd.write_string()で表示
     - 3秒間表示
   - **スクロール表示**（16文字超）:
     - 文字列末尾にスペース4文字追加（"    "）
     - 1文字ずつ左にスクロール
     - lcd.home()でカーソルをホームに戻す
     - scroll_delay間隔で更新（デフォルト0.3秒）
     - スクロール完了後1秒待機
   - **表示フロー**:
     - 現在時刻付きヘッダー表示
     - 各サイト名を表示
     - 各サイトの要約を表示
     - 各ブロック間に2秒の待機時間
6. **定期更新機能**
   - 無限ループで以下を繰り返し:
     - RSSフィード取得 → AI要約生成 → LCD表示
     - `UPDATE_INTERVAL` 分（デフォルト180分=3時間）待機
     - 次のサイクル開始
   - Ctrl+C（KeyboardInterrupt）で終了
   - 終了時に "Goodbye!" メッセージを表示

## 9. 非機能要件
- **可読性**:
  - コードはPEP8準拠
  - 日本語コメントで初心者にもわかりやすい説明
  - 関数・クラスごとにdocstring記述
- **保守性**:
  - クラスベースの設計でLCD操作をカプセル化
  - 関数分割とモジュール化により拡張しやすい設計
- **単一ファイル完結**: 可能な限り一つのPythonファイルで実装
- **移植性**:
  - RPLCDライブラリを使用し、他のI²Cエクスパンダにも対応可能
  - 設定値（I²Cアドレス、ポート）をコマンドライン引数で変更可能
- **信頼性**: ネットワーク障害やAPIエラー時にリトライとエラーログを実装
- **安全性**:
  - 電圧レベル変換により、Raspberry Pi GPIOピンを5V信号から保護
  - 適切なエラーハンドリング実装
  - I²Cアドレス・引数の検証

## 10. 安全要件
### 10.1 電圧レベル保護
- **必須**: BSS138双方向ロジックレベル変換モジュールを使用
  - Raspberry Pi I²Cピン（3.3V）を5Vプルアップから保護
  - PCF8574Tモジュールは5V駆動でLCDバックライトを明るく点灯
  - I²C信号（SDA/SCL）は3.3V⇔5V間で双方向変換
- **警告**: レベル変換なしで5V I²Cプルアップに直接接続すると、Raspberry Pi GPIOピンが破損する可能性あり

### 10.2 配線時の注意事項
- 電源投入前に配線を確認
- VCCとGNDのショート防止
- ジャンパーワイヤの接続確認

## 11. テスト要件
- **I²C有効化確認**: Raspberry Pi設定でI²Cが有効化されていることを確認
- **I²C通信テスト**: `i2cdetect -y 1`でPCF8574TのI²Cアドレス（0x27または0x3F）検出
- **レベル変換確認**: オシロスコープまたはロジックアナライザでSDA/SCL信号レベルを確認（オプション）
- **ライブラリインストール確認**:
  - `pip list | grep -E "(feedparser|openai|RPLCD|smbus2|python-dotenv)"` で5つのライブラリが表示されること
- **RSSフィード取得テスト**:
  - 各RSSフィードURLから記事が正常に取得できること
  - feedparserでのXML解析が正常に動作すること
  - 記事のタイトル、要約、リンクが正しく抽出されること
  - ネットワークエラー時に適切なエラーハンドリングが動作すること
- **AI要約生成テスト**:
  - 無効APIキー時のエラーハンドリング検証
  - 複数記事を統合した要約が250文字以内で生成されること
  - 日本語要約が正しく生成されること
  - 英語ソース記事が日本語で要約されること
- **LCD表示テスト**:
  - 短文（16文字以内）で正常表示確認（3秒表示）
  - 長文（16文字超）でスクロール動作確認（0.3秒間隔）
  - 各ニュース要約の切り替え動作確認（2秒間隔）
  - シミュレーションモードでの動作確認
- **定期更新テスト**:
  - UPDATE_INTERVAL設定値に応じた更新間隔で動作すること
  - 3時間（180分）サイクルで正常に動作すること
- **異常系テスト**:
  - 無効なI²Cアドレス指定時のシミュレーションモード切り替え確認
  - RSSフィード取得失敗時の適切なエラーメッセージ表示確認
  - OpenAI API呼び出し失敗時のエラーメッセージ表示確認
- **割り込みテスト**: Ctrl+C押下時の適切な終了処理（"Goodbye!"メッセージ、LCD画面クリア）確認

## 12. 受け入れ基準
1. **ハードウェア構成**:
   - BSS138レベル変換モジュールを経由してRaspberry PiとPCF8574T搭載LCD1602が正しく接続されている
   - `i2cdetect -y 1`でPCF8574TのI²Cアドレス（0x27）が検出される
2. **RSSフィード取得機能**:
   - 3つのRSSフィードソース（MIT Technology Review AI、AI News、ITmedia AI+）から記事が正常に取得される
   - 各サイトから最大3件の記事（タイトル、要約、リンク）が取得される
   - ネットワークエラー時に適切なエラーログが記録される
3. **AI要約生成機能**:
   - OpenAI API（gpt-5-mini）で日本語要約が250文字以内で生成される
   - 複数記事が統合され、技術トレンドがひと目でわかる要約になっている
   - 英語ソースの記事も日本語で要約される
4. **LCD表示機能**:
   - 起動時に "News Display" / "Starting..." が表示される
   - 現在時刻付きヘッダーが表示される
   - 各サイト名と要約が順次表示される
   - 16文字以内のテキストは3秒間表示される
   - 16文字を超えるテキストは0.3秒間隔で横スクロール表示される
   - 各ブロック間に2秒の待機時間がある
5. **シミュレーションモード**:
   - LCD未接続時やエラー時にシミュレーションモードに切り替わる
   - コンソールに "[LCD表示]" プレフィックス付きで出力される
   - プログラムが停止せずに動作し続ける
6. **定期更新機能**:
   - UPDATE_INTERVAL設定値（デフォルト180分=3時間）で自動更新される
   - ログに「○時間後に次の更新を行います...」と表示される
   - 無限ループで動作し続ける
7. **エラーハンドリング**:
   - RSSフィード取得失敗時にエラーログが記録され、次のサイトに進む
   - OpenAI API呼び出し失敗時にエラーメッセージが生成される
   - I²C通信エラー時にシミュレーションモードに切り替わる
   - 予期しないエラーがログに記録される
8. **終了処理**:
   - Ctrl+C（KeyboardInterrupt）で正常に終了する
   - 終了時にLCDに "Goodbye!" が表示される
   - 終了時にLCD画面がクリアされる
   - ログに「アプリケーションを終了します」と記録される
9. **安全性**:
   - 電圧レベル変換により、Raspberry Pi GPIOピンが保護されている
   - 環境変数にAPIキーが安全に格納される
   - .envファイルが.gitignoreで除外され、GitHubにアップロードされない

---
以上の要件をもとに、ニュース要約掲示板アプリのプロトタイプを開発してください。

## 13. 参考文献・データシート
- [PCF8574 Remote 8-Bit I/O Expander Datasheet (Texas Instruments)](https://www.ti.com/lit/ds/symlink/pcf8574.pdf)
- [BSS138 N-Channel MOSFET Datasheet](https://cdn.sparkfun.com/datasheets/BreakoutBoards/BSS138.pdf)
- [HD44780 LCD Controller Datasheet](https://www.sparkfun.com/datasheets/LCD/HD44780.pdf)
- [RPLCD Documentation](https://rplcd.readthedocs.io/)
- [NXP I2C Level Shifting Techniques (Application Note AN10441)](https://www.nxp.com/docs/en/application-note/AN10441.pdf)
- [OpenAI API サンプル](https://murasan-net.com/2025/03/20/openai-api-sample-2025/)

---

**最終更新**: 2025年10月27日
**文書番号**: 09-002
**バージョン**: 2.0
